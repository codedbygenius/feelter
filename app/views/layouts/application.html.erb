<!DOCTYPE html>
<html>
<head>
  <title>Feelter</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%# 1. Tailwind CDN - This replaces the broken local tailwind.css %>
  <script src="https://cdn.tailwindcss.com"></script>

  <%# 2. Application CSS - Ensure app/assets/stylesheets/application.scss is EMPTY to avoid crashes %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <%# JS Libraries %>
  <%= javascript_include_tag "https://www.gstatic.com/charts/loader.js" %>
  <%= javascript_include_tag "https://unpkg.com/chartkick@5.0.1/dist/chartkick.js" %>

  <%# Turbo - Loaded via CDN since the bundler is missing %>
  <script src="https://unpkg.com/@hotwired/turbo@8.0.0/dist/turbo.es2017-umd.js"></script>

  <script>
    document.addEventListener("turbo:load", () => {
      console.log("Turbo is active!");
    })
  </script>

  <style>
    /* Global Styles */
    body {
      padding-bottom: 90px;
      background-color: #fcfaf7;
    }

    path {
      stroke-width: 3;
      stroke-linecap: round;
      filter: blur(0.5px);
    }

    .navbar-zen {
      height: 60px;
      background: rgba(252, 250, 247, 0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 1000;
      width: 100%;
    }

    main.content-wrapper {
      padding-top: 20px;
      padding-bottom: 100px;
      min-height: calc(100vh - 150px);
    }

    .navbar-brand { font-size: 2.5rem; text-decoration: none; color: #1e293b; }

    .footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      height: 70px;
      background: white;
      border-top: 1px solid #f1f5f9;
      padding: 10px 0;
      z-index: 1000;
      box-shadow: 0 -5px 15px rgba(0,0,0,0.03);
    }

    .footer-items {
      display: flex;
      justify-content: space-around;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .footer-link {
      text-decoration: none;
      color: #94a3b8;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: 'Quicksand', sans-serif;
      font-size: 11px;
      transition: color 0.3s;
    }

    .footer-link i { font-size: 20px; margin-bottom: 4px; }
    .footer-link.active, .footer-link:hover { color: #fca5a5; }

    .profile-circle {
      width: 40px; height: 40px; border-radius: 50%;
      background: #fff1f2; border: 1px solid #fecaca; color: #fb7185;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>

<body>
  <%# 1. Zen Loader %>
  <div id="zen-loader" style="display: none; position: fixed; inset: 0; background: white; z-index: 9999; justify-content: center; align-items: center; transition: opacity 0.5s;">
    <div class="pencil-line"></div>
  </div>

  <%# 2. Top Navigation %>
  <%= render "shared/navbar" if user_signed_in? %>

  <%# 3. Flash Messages %>
  <%= render "shared/flashes" %>

  <%# 4. Main Content %>
  <main class="content-wrapper">
    <%= yield %>
  </main>

  <%# 5. Bottom Navigation %>
  <%= render "shared/footer" if user_signed_in? %>

  <script>
    document.addEventListener('turbo:click', function() {
      const loader = document.getElementById('zen-loader');
      if (loader) loader.style.display = 'flex';
    });

    document.addEventListener('turbo:load', function() {
      const loader = document.getElementById('zen-loader');
      if (loader) {
        loader.style.opacity = '0';
        setTimeout(() => {
          loader.style.display = 'none';
          loader.style.opacity = '1';
        }, 500);
      }
    });
  </script>
</body>
</html>
